<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; connect-src 'self' https://*.google.com https://www.google.com https://api.mymemory.translated.net https://dns.google; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src *; img-src 'self' data:;">
    <title>Audio Recorder - Microphone Selection</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤ Audio Translator</h1>
        </div>

        <!-- Microphone Selection -->


        <!-- Language Selection -->
        <div class="section">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div>
                    <label for="inputLang">Input Language:</label>
                    <select id="inputLang">
                        <option value="vi-VN" selected>Vietnamese</option>
                        <option value="en-US">English</option>
                        <option value="zh-CN">Chinese (Simplified)</option>
                        <option value="ja-JP">Japanese</option>
                        <option value="ko-KR">Korean</option>
                        <option value="th-TH">Thai</option>
                    </select>
                </div>
                <div>
                    <label for="outputLang">Output Language:</label>
                    <select id="outputLang">
                        <option value="vi">Vietnamese</option>
                        <option value="en">English</option>
                        <option value="zh" selected>Chinese</option>
                        <option value="ja">Japanese</option>
                        <option value="ko">Korean</option>
                        <option value="th">Thai</option>
                    </select>
                </div>
            </div>
            <div style="margin-top: 12px;">
                <label for="voiceSelect">Select Voice:</label>
                <select id="voiceSelect">
                    <option value="">Loading voices...</option>
                </select>
            </div>
        </div>


        <!-- Microphone Signal Status -->
        <div class="section" style="padding: 12px; background: #f5f5f5; border-radius: 8px; margin-bottom: 20px;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                <span style="font-weight: 600; color: #333;">ğŸ™ï¸ Microphone Status:</span>
                <span id="micStatus" style="font-weight: 600; color: #ff6b6b;">OFF</span>
            </div>
            <div style="width: 100%; height: 8px; background: #ddd; border-radius: 4px; overflow: hidden;">
                <div id="audioLevelBar"
                    style="height: 100%; width: 0%; background: linear-gradient(90deg, #667eea, #764ba2); transition: width 0.1s ease;">
                </div>
            </div>
            <div style="font-size: 12px; color: #999; margin-top: 4px;">
                Audio Level: <span id="audioLevelText">0</span>%
            </div>
        </div>

        <!-- Status -->
        <div class="status" id="status">
            <span class="status-dot"></span>
            <span id="statusText">Ready</span>
        </div>

        <!-- Control Buttons -->
        <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap;">
            <button class="btn-start" id="startBtn" onclick="handleStartRecording()" style="min-width: 150px;">Start
                Recording</button>
            <button id="autoStartBtn" onclick="toggleAutoStart()"
                style="padding: 12px 20px; background: #51cf66; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                Auto-Start: ON</button>
            <button onclick="testMicrophoneAccess()"
                style="padding: 12px 20px; background: #673ab7; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                ğŸ™ï¸ Test Microphone</button>
            <button onclick="testNetworkConnection()"
                style="padding: 12px 20px; background: #ff9800; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                ğŸŒ Test Network</button>
            <button onclick="testNetworkDiagnostics()"
                style="padding: 12px 20px; background: #ff5722; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                ğŸ” Full Diagnostics</button>
            <button onclick="testTranslationAPI()"
                style="padding: 12px 20px; background: #2196f3; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                ğŸ”„ Test API</button>
            <button onclick="diagnoseSpeechRecognition()"
                style="padding: 12px 20px; background: #9c27b0; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                ğŸ”§ Diagnose Speech</button>
            <button onclick="testSpeechRecognitionSimple()"
                style="padding: 12px 20px; background: #e91e63; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                ğŸ¤ Simple Test</button>
            <button onclick="testStartSpeech()"
                style="padding: 12px 20px; background: #f44336; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                ğŸ¤ Test Speech (5s)</button>
        </div>

        <!-- Transcription History -->
        <div class="audio-section">
            <label>ğŸ“ Transcription History:</label>
            <div id="transcriptionList" style="max-height: 400px; overflow-y: auto; font-size: 14px;">
                <p style="color: #999; text-align: center; padding: 20px 0;">No transcriptions yet...</p>
            </div>
        </div>

        <!-- Version & Contact Info -->
        <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee;">
            <p class="subtitle" id="versionText" onclick="toggleWhatsNew()"
                style="cursor: pointer; transition: color 0.2s ease; margin-bottom: 8px;"
                onmouseover="this.style.color='#667eea'" onmouseout="this.style.color='#666'">Loading info...</p>
            <p class="subtitle" style="font-size: 12px; margin-top: 8px;">
                Contact: <a id="emailLink" href="#"
                    style="color: #667eea; text-decoration: none;">tr.tuanpham@gmail.com</a>
            </p>
        </div>
    </div>

    <!-- Custom Input Modal (Fallback for prompt in Electron) -->
    <div id="inputModal"
        style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div
            style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); max-width: 400px; width: 90%;">
            <h2 id="modalTitle" style="margin-top: 0; color: #333;">Enter Text</h2>
            <textarea id="modalInput" placeholder="Type here..."
                style="width: 100%; height: 80px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; font-size: 14px; resize: vertical;"></textarea>
            <div style="display: flex; gap: 10px; margin-top: 16px; justify-content: flex-end;">
                <button id="modalCancel"
                    style="padding: 10px 20px; background: #ccc; border: none; border-radius: 6px; cursor: pointer;">Cancel</button>
                <button id="modalOk"
                    style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">OK</button>
            </div>
        </div>
    </div>

    <!-- Load external JavaScript files -->
    <!-- Speech Transcriber Module -->
    <script src="speech-transcriber.js"></script>
    <!-- Mic Signal Detector (includes audio initialization) -->
    <script src="mic-signal-detector.js"></script>
    <!-- Translator Module -->
    <script src="translator.js"></script>
    <!-- Version Configuration -->
    <script src="version.js"></script>
    <!-- What's New Modal Web Component -->
    <script src="popups/whats-new-modal.js"></script>
    <!-- What's New Modal Element (initialized after scripts load) -->
    <whats-new-modal></whats-new-modal>
    <!-- App Main Module -->
    <script src="app.js"></script>
</body>

</html>